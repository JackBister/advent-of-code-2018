
interface Point {
    x, y: number;
}

type Direction = 'v' | '^' | '>' | '<';

interface Car {
    id: number;
    numberOfIntersections: number;
    position: Point;
    direction: Direction;
}

function positionComparator(a: Car, b: Car) {
    if (a.position.y < b.position.y) {
        return -1;
    } else if (a.position.y > b.position.y) {
        return 1;
    } else {
        return a.position.x - b.position.x;
    }
}

function isHorizontal(direction: Direction) {
    return direction === '<' || direction === '>';
}

function turnLeft(direction: Direction) {
    switch(direction) {
        case '<':
            return 'v';
        case '>':
            return '^';
        case '^':
            return '<';
        case 'v':
            return '>';
    }
}

function turnRight(direction: Direction) {
    switch(direction) {
        case '<':
            return '^';
        case '>':
            return 'v';
        case '^':
            return '>';
        case 'v':
            return '<';
    }
}

function getNewDirection(currentDirection: Direction, symbolAtNewPosition: string, numberOfIntersections: number) {
    if (symbolAtNewPosition === '/') {
        if (!isHorizontal(currentDirection)) {
            return turnRight(currentDirection);
        } else {
            return turnLeft(currentDirection);
        }
    } else if (symbolAtNewPosition === '\\') {
        if (!isHorizontal(currentDirection)) {
            return turnLeft(currentDirection);
        } else {
            return turnRight(currentDirection);
        }
    } else if (symbolAtNewPosition === '+') {
        if (numberOfIntersections % 3 === 0) {
            return turnLeft(currentDirection);
        } else if (numberOfIntersections % 3 === 1) {
            return currentDirection;
        } else if (numberOfIntersections % 3 === 2) {
            return turnRight(currentDirection);
        }
    } else {
        return currentDirection;
    }
}

function day13(input: string, isPart2: boolean) {
    let rows = input.split('\n');

    let id = 0;
    let cars: Car[] = [];
    for (let y = 0; y < rows.length; ++y) {
        for (let x = 0; x < rows[y].length; ++x) {
            let v = rows[y][x];
            if (v === 'v' || v === '^' || v === '>' || v === '<') {
                cars.push({ id: id++, numberOfIntersections: 0, position: { x, y }, direction: v });
            }
        }
    }

    let ignored = new Set<number>();
    let positionsThisFrame = new Map<string, number>();

    let numTicks = 0;
    while (true) {
        cars = cars.sort(positionComparator);
        let hasMovedThisFrame = new Set<number>();
        let positionsLastFrame = positionsThisFrame;
        positionsThisFrame = new Map<string, number>();
        for (let car of cars) {
            if (ignored.has(car.id)) {
                continue;
            }
            if (car.direction === 'v') {
                car.position.y++;
            } else if (car.direction === '^') {
                car.position.y--;
            } else if (car.direction === '>') {
                car.position.x++;
            } else if (car.direction === '<') {
                car.position.x--;
            }

            let symbolAtNewPosition = rows[car.position.y][car.position.x];
            car.direction = getNewDirection(car.direction, symbolAtNewPosition, car.numberOfIntersections);
            if (symbolAtNewPosition === '+') {
                car.numberOfIntersections++;
            }
            
            if (positionsLastFrame.has(`${car.position.x}|${car.position.y}`)
                && positionsLastFrame.get(`${car.position.x}|${car.position.y}`) !== car.id
                // Since the cars move in order from top left to bottom right we could have "phantom collisions" if not for this check
                && !hasMovedThisFrame.has(positionsLastFrame.get(`${car.position.x}|${car.position.y}`))
                && !ignored.has(positionsLastFrame.get(`${car.position.x}|${car.position.y}`))
                ) {
                if (!isPart2) {
                    console.log(car.position);
                    return;
                }
                ignored.add(car.id);
                ignored.add(positionsLastFrame.get(`${car.position.x}|${car.position.y}`));
            }

            hasMovedThisFrame.add(car.id);
            positionsThisFrame.set(`${car.position.x}|${car.position.y}`, car.id);
        }
        for (let car of cars) {
            if (ignored.has(car.id)) {
                continue;
            }
            if (positionsThisFrame.has(`${car.position.x}|${car.position.y}`)
                && positionsThisFrame.get(`${car.position.x}|${car.position.y}`) !== car.id
                && !ignored.has(positionsThisFrame.get(`${car.position.x}|${car.position.y}`))
                ) {
                if (!isPart2) {
                    console.log(car.position);
                    return;
                }
                ignored.add(car.id);
                ignored.add(positionsThisFrame.get(`${car.position.x}|${car.position.y}`));
                positionsThisFrame.set(`${car.position.x}|${car.position.y}`, car.id);
            }
        }
        if (ignored.size === cars.length - 1) {
            break;
        }
        numTicks++;
    }
    
    console.log(numTicks, cars.find((c) => !ignored.has(c.id)));

    return;
}

day13(String.raw`/->-\        
|   |  /----\
| /-+--+-\  |
| | |  | v  |
\-+-/  \-+--/
  \------/  `, false);

day13(String.raw`/>-<\  
|   |  
| /<+-\
| | | v
\>+</ |
  |   ^
  \<->/`, true);


day13(String.raw`                                       /----------------------------------------------------\          /----------------------------\                 
                /-------->-------\     |                                               /----+----------+----------------------------+----------\      
                |               /+-----+-----------------------------------------------+----+----------+-\                      /---+-------\  |      
                |       /-------++-----+-----------------------------------------------+----+----------+-+---\                  |   |       |  |      
             /--+-------+-------++-----+-----------------------------------------------+---\|          | |   |                  |   |       |  |      
  /----------+--+-----\ |       ||     |            /----------------------------------+---++----------+-+---+----\             |   |       |  |      
  |          |  | /---+-+-------++-----+------------+--------------->------------------+---++----------+-+\  |    |             |   |       |  |      
  |    /-----+--+-+---+-+-------++-----+------------+----------------------------------+---++---\      | ||  |    |             |   |       |  |      
  |    |     |  | |   | |       ||     |            |              /-------------------+---++---+--\   | ||  |    |             |   |       |  |      
 /+----+-----+--+-+---+-+-------++-----+------------+\             |                   |   ||   |  |   | ||  |    |             |   |       |  |      
 ||    | /---+--+-+---+-+-------++-----+------------++-------------+-------------------+---++---+--+-\ | ||  |    |             |   |       |  |      
 ||    | |   |  | |   | |       ||   /-+---------\  ||             |                   |   ||   |  | | | ||  |    |             |   |       |  |      
 ||    | |   |  | |   | |       ||   | |         |  ||             |                   |   ||   |  | | | ||  |    |             |   |       |  |      
 ||    | |   |  | |   | ^       ||   | |         |  ||             |             /-----+---++---+--+-+-+-++--+----+-------------+---+--\    |  |      
 ||    | |   |  | |   | |       ||/--+-+---------+--++-------------+------->-----+-----+\  ||   |  | | | ||  |    |             |   |  |    |  |      
 ||    | |   |  | |   | |       |||  | |         |  ||     /-------+-------------+-----++--++---+--+-+-+-++--+----+-------------+---+\ |    |  |      
 ||    | |   |  | |   | |       |||  |/+---------+--++-----+-------+-------------+-----++--++---+--+-+-+-++--+----+-------------+---++\|    |  |      
 ||    \-+---+--+-+---+-+-------+++--+++---------+--++-----+-------+-------------+-----++--++---/  | | | ||  |/---+-------------+---++++----+--+\     
 ||      |   |  | |   | |       |||  |||         |  ||     |       |             |     ||  ||      | | | ||  ||   |             \---++++----/  ||     
 ||      |   |  \-+---+-+-------+/|  |||         |  ||     |       |             |     |v  ||      | | | ||  ||   |                 ||||       ||     
 ||      |   |    |   | |       | |/-+++-----\   |  ||     |       |             |     ||  ||      | | | ||  ||   |                 ||||       ||     
 ||      |   |    |   | |       | || |||     |   |  ||     |       |             |     ||  || /----+-+-+-++--++---+-----------------++++-------++--\  
 ||      |  /+----+---+-+-------+-++-+++-----+---+--++-\   |       |             |     ||  || |    | | | ||  ||   |                 ||||       ||  |  
 ||   /--+--++----+---+-+--\    | || |||     |   |  || |   |       |      /------+-----++--++-+----+-+-+-++--++---+-----------------++++--\    ||  |  
 ||   |  |  ||    |   | |  |    | || |||     |   |  || |   |       |      |    /-+-----++-\|| |    | | | ||  ||   |                 ||||  |    ||  |  
 ||   |  |  ||/---+---+-+--+----+-++-+++-----+---+--++-+---+--->---+-\    |    | |     || |||/+----+-+-+-++--++---+-----------------++++--+----++--+\ 
 ||   |  |  |||   |   | |  |    | || |||     |   |  || |   |       | |    |    | \-----++-+++++----+-+-+-++--++---+-----------------+++/  |    ||  || 
 ||   |  |  |||   |   | |  |    | || |||     |   |  || |  /+-------+-+----+----+-------++\|||||    | | | ||  ||   |                 |||   |    ||  || 
 ||   |  |  |||   |   | |  |   /+-++-+++-----+---+--++-+--++-------+-+\  /+----+-------++++++++----+-+-+-++--++---+-----------------+++-\ |    ||  || 
 ||   |  |  ||| /-+---+-+--+---++-++-+++-----+---+--++-+--++-------+-++--++----+------\||||||||    | | | ||  ||   |                 ||| | |    ||  || 
 ||   |  |  ||| | |   | |  |   || || |||     |   |  || |  ||       | ||  ||    |      |||||||||    |/+-+-++--++---+-----------------+++-+-+\   ||  || 
 ||   |  |  ||| | |   | |  |   || || |||     |   |  || |  ||       \-++--++----+------+++++++++----/|| | || /++---+------------\    ||| | ||   ||  || 
 ||   |  |  ||| | |   | |  |   || || |||     |   |  || |  ||        /++--++----+---\  |||||||||     || | || |||   |            |    ||| | ||   ||  || 
 ||   |  |  ||| | |   | |  |   || || |||     |   |  || |  ||        |||  ||    |   |  |||||||||     || | || ||\---+------------+----+++-+-++---+/  || 
 ||   |  |  ||| | |   | |  |   || || |||     |/--+--++-+--++-------\|||  ||    |   |  |||||||||     || | || ||    |            |    ||| | ||   |   || 
 ||   |  | /+++-+-+---+-+--+---++-++-+++-----++--+--++-+--++-------++++--++----+---+--+++++++++----\|| | || ||    |            |    ||| | ||   |   || 
 ||   |  | |||| | |   | |  |   || || ||\-----++--+--++-+--++-------++++--++----+---+--++++++/||    ||| | || ||    |            |    ||| | ||   |   || 
 ||   |  | |||| | |/--+-+--+---++-++-++------++--+--++\|  ||  /----++++--++----+---+--++++++-++----+++-+-++-++----+------\     |    ||| | ||   |   || 
 ||   |  | |||| | ||  | |  |   || || ||      ||  |  ||||  ||  |    ||||  ||    |   |  |||||| ||    ||| | || ||    |      |     |    ||| | ||   |   || 
 ||   |  | |||| | ||  | |  |   || || ||     /++--+--++++--++--+----++++--++----+---+--++++++-++----+++-+-++-++----+------+-----+----+++-+-++---+---++\
 ||   |  | |||| | ||  | |  |   || || || /---+++--+--++++--++--+----++++--++----+---+--++++++-++----+++-+-++-++\   |      |    /+----+++-+-++---+--\|||
 ||   |  | |||| | ||  | |  |   || || || |   |||  |  \+++--++--+----++++--++----+---+--++++++-++----+++-+-++-+++---/      |    ||    ||| | ||   |  ||||
 ||   |  | |||| | ||  | |  |   || || \+-+---+++--/   |||  ||  |    ||||  ||    |   |  |||||| ||    ||| | || |||          |    ||    ||| | ||   |  ||||
 ||   |  | |||| | ||  | |  |   || ||  |/+---+++------+++--++--+----++++--++\   |   |  |||||| ||    ||| | || |||          |    ||    ||| | ||   |  ||||
 ||   |  | |||| | ||  | |  |   || ||  |||   |||      |||  ||  |    ||||/-+++---+---+--++++++-++----+++-+-++-+++----------+----++----+++-+\||   |  ||||
 ||   |  | |||| \-++--+-+--+---++-++--+++---+++------+++--++--+----+++++-+++---+---+--/||||| ||    ||| | || |||          |    ||    ||| ||||   |  ||||
 ||   |  | ||||   ||  | |  |   || ||  |||   |||      |||  ||  |    ||||| |||   |   |   ||||| ||    ||| | || |||          |    ||    ||| ||||   |  ||||
 ||   |  | ||||   ||  | |  |   || ||  |||   ||| /----+++--++--+----+++++-+++---+---+---+++++-++----+++-+-++-+++----------+----++---\||| ||||   |  ||||
 ||   | /+-++++---++--+-+--+---++-++--+++---+++-+----+++--++--+----+++++-+++\  |   |   ||||| ||    ||| | || |||          |    ||/--++++-++++\  |  ||||
 ||   |/++-++++---++--+-+--+--\|| ||  |||   ||\-+----+++--++--+----/\+++-++++--+---/   ||||| ||    ||| | || |||          |    |||  |||| |||||  |  ||||
 ||   |||| ||||   ||  | |  |  ||| ||  |||   ||  |    |||  ||  |      ||| ||||  |       ||||| ||  /-+++-+-++-+++---\      |    |||  |||| |||||  |  ||||
 |\---++++-++++---++--/ |  |  ||| ||  |||   ||  |    |||  ||  \------+++-++++--+-------+++++-++--+-+++-+-++-+++---+------/    |||  |||| |||||  |  ||||
 |    |||| ||||   ||    |  |  ||| ||  |||   ||  |    |||  ||         ||| ||||  |       ||||| ||  | ||| | || |||   |           |||  |||| |||||  |  ||||
 |    |||| ||||   ||    \--+--+++-++--+++---++--+----+++--++---------+++-++++--+-------+++++-++--+-+++-+-++-+/|   |           |||  |||| |||||  |  ||||
 |    ||||/++++---++-------+--+++-++--+++---++--+----+++--++---------+++\||||  |       ||||| ||  | |||/+-++-+-+---+-----------+++--++++-+++++--+\ ||||
 |    ||||||||\<--++-------+--+++-++--+++---++--+----+++--++---------/|||||||  \-------+++/| ||  | ||||| || \-+---+-----------+/|  |||| |||||  || ||||
 |    ||||||||   /++------\|  ||| || /+++---++--+----+++--++----------+++++++----------+++-+-++--+-+++++-++---+---+---------\ | |  |||| |||||  || ||||
 |    ||||||||   |||      ||/-+++-++-++++---++--+-\  |||  ||          |||||||          ||| | ||  | ||||| ||   |   |         | | |  |||| |||||  || ||||
 |    ||||||||   |||      ||| ||| || ||||   ||  | |  |||  ||          |||||||         /+++-+-++--+-+++++-++\  |   |         | | \--++++-++++/  || ||||
 |    ||||||||   |||      ||| ||| || ||||   ||  | |  |||  ||          |||||||         |\++-+-++--+-+++++-+++--+---+---------+-+----++++-++++---/| ||||
 | /--++++++++---+++------+++-+++-++-++++---++--+-+--+++\ ||          |||||||         | || | ||  | ||||| |||  |   |         | \----++++-++++----+-/|||
 | |  ||||||||   |||      ||| ||| || ||||   ||  | |  |||| ||          |||||||         | || | ||  | ||||| |||  |   |/--------+----\ |||| ||||    |  |||
 | |  ||||||||   |||     /+++-+++-++-++++---++--+-+--++++-++----------+++++++---\     | || | ||  | ||||| |||  |   || /------+---\| |||| ||||    |  |||
 | |  ||||||||   |||     |||| ||| || ||||   ||  | |  |||| ||    /-----+++++++---+---\ | || | ||  | ||||| |||  |/--++-+------+---++-++++-++++----+-\|||
 \-+--++++++++---+++-----++++-+++-++-++++---++--+-+--/||| ||    |     |||||||   |   | | || | ||  | ||||| |||  ||  || |      |   || |||| ||||    | ||||
   |  |||||||| /-+++-----++++-+++-++-++++---++--+\|   ||| ||    |     |||||||   |   | | || | ||  | ||||| |||  ||  || |      |   || |||| ||||    | ||||
   |  |||||||| | |||     |||| ||| ||/++++---++--+++---+++-++----+-----+++++++---+---+-+-++-+-++--+-+++++-+++--++--++-+------+\  || |||| ||||    | ||||
/--+--++++++++-+-+++-----++++-+++-+++++++---++--+++---+++-++----+-----+++++++---+---+-+-++-+-++--+-+++++-+++\ ||  || |      ||  || |||| ||||    | ||||
|  |  |||||||| | |||     ||||/+++-+++++++---++--+++---+++-++----+-----+++++++---+\  | | || | |\--+-+++++-++++-++--++-+------++--++-++++-++++----+-+/||
|  |  |||||||| | |||     |||||||| |||||||   ||  |||   ||| ||    |     |||||||   ||  | | || | |   | ||||| |||| ||  || |      ||  || |||| ||||    | | ||
|  |  |||||||| | |||/----++++++++-+++++++---++--+++---+++-++----+-----+++++++---++--+-+-++-+-+---+-+++++-++++-++\ || |      ||  || |||| ||||    | | ||
|  |  |||||||| | ||||    |||||||| ||||||| /-++--+++---+++-++----+-----+++++++---++--+\| || | |   | ||||| |||| ||| || |      ||  || |||| ||||    | | ||
|  |  |||||||| | ||||    |||||||| ||||||| | ||  |||   ||| ||    |     |||||||   ||  ||| || | |   | ||||| |||| ||| || |      ||  || |||| ||||    | | ||
|  |  |||\++++-+-++++----++++++++-+++++++-+-++--+++---+++-++----+-----+++++++---++--+++-++-+-+---+-++/|| |||| ||| || |      ||  || |||| ||||    | | ||
|  |  ||| |||| | ||||    ||||||||/+++++++-+-++\ |||   ||| ||    \-----+++++++---++--/|| || | |   | || || |||| ||| || |      ||  || |||| ||||    | | ||
|  |  ||| |||| | ||||    |||||||\++++++++-+-+++-+++---+++-++----------+++++++---++---++-++-+-+---+-++-++-/||| ||| || |      ||  || |||| ||||    | | ||
|  |  ||| |\++-+-++++----+++++++-++++++++-+-+++-+++---+++-++----------+++++++---++---++-++-+-+---+-/\-++--+++-+++-++-+------++--++-++++-+++/    | | ||
|  |  ||| | || | ||||    ||||||| |||||||| | ||| |||   ||| ^|          ||||\++---++---++-++-+-+---+----++--+++-+++-++-+------++--++-++++-++/     | | ||
|  |  ||| | || | ||||    ||||||| ||||||\+-+-+++-+++---+++-++----------++++-/|/--++---++-++-+-+---+----++--+++-+++-++-+-\    ||  || |||| ||      | | ||
|  |  ||| | || \-++++----+++++++-++++++-+-+-+++-+/| /-+++-++-------\  ||||  ||  ||   || |v | v   |    \+--+++-+++-++-+-+----++--++-++++-++------/ | ||
|  |  ||| | ||   |\++----+++++++-++++++-+-+-+++-+-+-+-+++-++-------+--++++--++--++---++-++-+-+---+-----+--/|| ||| || | |    ||  || |||| ||        | ||
| /+--+++-+-++---+-++----+++++++-++++++-+-+-+++-+-+-+-+++-++-------+--++++--++-\||   || || | |  /+-----+---++-+++-++-+-+----++--++-++++-++-----\  | ||
| ||  ||| | \+---+-++----+++++++-++++++-+-+-+++-+-+-+-+/| ||       |  ||||  || |||   || || | |  ||     |   || |\+-++-+-+----++--++-++++-++-----+--/ ||
| ||  ||| |  |   |/++----+++++++-++++++-+-+-+++-+-+-+-+-+-++-------+--++++--++-+++---++-++-+-+--++-----+---++-+\| || | |    ||  || |||| ||     |    ||
| ||  ||| |  |   ||||    ||||||\-++++++-+-+-+++-+-+-+-+-+-++-------+--/|||  || |||   || || | |  || /---+---++-+++-++-+-+----++--++-++++-++---\ |    ||
| ||  ||| | /+---++++----++++++--++++++-+-+-+++-+-+-+-+-+-++-------+---+++--++-+++---++-++-+-+--++-+--\|   || ||| || | |    ||  || |||| ||   | |    ||
| ||  ||| | || /-++++----++++++\ |||||| | \-+++-+-+-+-+-+-++-------+---+++--++-+++---/| ||/+-+--++-+--++---++-+++-++-+\|    ||  || |||| ||   | |    ||
| ||  ||\-+-++-+-++++----+++++++-++++++-+---+++-+-+-+-+-+-++-------+---+++--/| |||    | |||| |  || |  ||   || ||| || |||    ||  || |||| ||   | |    ||
| ||  ||  | |\-+-++++----+++++++-++++++-+---+++-+-+-+-+-+-++-------+---+++---+-+++----+-+++/ |  || |  ||   || ||| || |||    ||  || |||| ||   | |    ||
| ||  ||  | |  | \+++----+/||||| \+++++-+---++/ | | | | | ||       |   |||   | |||    | |||  |  || |  ||   || ||| || |||    ||  || |||| ||   | |    ||
| ||  ||  | |  |  |\+----+-+++++--+++++-+---++--+-+-+-/ | ||       |   |||   | |||    | |||  |  || |  ||   || ||| || |||    ||  || |||| ||   | |    ||
| ||  ||  | |  |  | |    | |||||  ||||| |   ||  | | |  /+-++-------+\  |||   | |||    | |||  |  || |  ||   || ||| || |||    ||  || |||| ||   | |    ||
| ||  ||  \-+--+--+-+----+-+++++--+++++-+---++--+-+-+--++-++-------++--+/|   | |||    \-+++--+--++-+--++---/| ||| || |||    ||  || |||| ||   | |    ||
| ||  ||    |  |  | |    | |||||  ||||| |   ||  | | |  || ||  /----++--+-+---+-+++------+++--+--++-+--++----+-+++-++-+++----++-\|| |||| ||   | |    ||
| ||  ||/---+--+-\| |/---+-+++++--+++++-+---++--+-+-+--++-++--+----++--+-+---+-+++----\ |||  |  ||/+--++----+-+++-++-+++----++-+++-++++-++---+\|    ||
| ||  |||   |  | || ||   | |||||  ||||| |   ||  | | |  || ||  |    ||  | |   | |||    | |||  \--++++--++----+-+++-++-+++----++-+++-++++-++---+++----/|
| ||  |||   |  | || ||   | |||||  ||||| |   ||  | | | /++-++--+----++--+-+---+-+++----+-+++-----++++--++----+-+++-++-+++----++-+++\|||| ||   |||     |
| ||  |||   ^  | || ||   | |||||  ||||| |   ||  | | | ||| ||  |    ||  | |   | |||    | |||     |||\--++----+-+++-++-+++----++-++++++++-++---/||     |
| ||  |||   |  | || ||   | |||||  ||||| |   ||  \-+-+-+++-++--+----++--+-+---+-+++----+-+++-----+++---++----+-+++-++-+++----++-++++/||| ||    ||     |
| ||  |||   |  | || ||   | |||||  ||||| |   ||    | | ||| ||  |  /-++--+-+---+-+++----+-+++-----+++---++----+-+++-++-+++--\ || |||| ||| ||    ||     |
|/++--+++---+--+-++-++---+-+++++--+++++-+--\||    |/+-+++-++--+--+\||  | |   | |||    | |||     |||   |\----+-+++-++-+++--+-++-++++-/|| ||    ||     |
||||  |||   |  | || ||   | |||||  ||||| |  |||   /+++-+++-++--+--++++--+-+---+-+++----+-+++-----+++---+-----+-+++-++-+++--+-++-++++\ || ||    ||     |
||||  |||   |  | || ||   | |||||  |\+++-+--++/   |||| ||| ||  |  ||||  | |   | |||    | |||     |||   |     | ||| || |||  | || ||||| || ||    ||     |
||||  |||   |  | || ||   | |||||  |/+++-+--++---\|||| ||| ||  |  ||||  | |   | |||    | |||     |||   |     | ||| || |||  | || ||||| || ||    ||     |
||||  |\+---+--+-++-++---+-+++/|  ||||| |  |\---+++++-+++-++--+--++++--+-+---+-+++----+-+++-----+++---+-----+-+++-++-+++--+-++-+++++-++-++----++-----/
||||  | |   |  | |\-++---+-+++-+--+++++-+--+----+++++-+++-++--+--++++--+-+---+-+++----+-+++-----+++---+-----+-+/| || |||  | || ||||| || ||    ||      
||||  | |   |  | | /++---+-+++\|  ||||| |  |    ||||| ||| ||  |  ||||  | |   | |||    | |||     |||   |     | | | || |||  | || ||||| || ||    ||      
||||  | |   | /+-+-+++--\| |||||  ||||| |  |    ||||| ||| ||  |  ||||  | |   | |||    | |||     |||   |     | | | || |||  | || ||||| || ||    ||      
||||  | |   | || | |||  || |||||  ||||| |  |    ||||| ||| ||  |  ||||  | |   | |||  /-+-+++-----+++---+----\| | | || |||  | || ||||| || ||    ||      
||||  | |   | || | ||| /++-+++++--+++++-+--+----+++++-+++-++--+--++++-\| |   | |||  | | |||     ||\---+----++-+-+-++-+++--+-++-+++++-++-++----/|      
||||  | |   | || | ||| ||| |||||  ||||| \--+----+++++-+++-++--+--++++-++-+---+-+++--+-+-+++-----++----+----++-/ | || |||  | || ||||| || ||     |      
||||  \-+--<+-++-+-+++-+++-/||||  |||||    |    |\+++-+++-++--+--++++-++-+---+-+++--+-+-+++-----++----+----++---+-++-+++--+-++-++++/ || ||     |      
||||    |   | || | ||| |||  ||||  |||||    |    | ||| ||| ||  |  |||| |\-+---+-+++--+-+-+++-----++----+----++---+-++-+++--+-++-++++--++-+/     |      
|\++----+---+-++-+-+++-+++--++++--+++++----/    | ||| ||| \+--+--++++-+--+---+-+++--+-+-+/|     |\----+----++---+-/| |||  | || ||||  || |      |      
| ||    |   | || | ||| |||  ||||  \++++---------+-+++-+++--+--+--++++-+--+---+-+++--+-+-/ |     |     |    ||   |  | |||  | || ||||  || |      |      
| ||    |   | || | ||| |||  ||||   |||\---------+-+++-+++--+--+--++++-+--+---+-+++--+-+---+-----+-----+----++---+--+-+++--+-++-++++--+/ |      |      
| ||    |   | || | ||| |||  ||||   |||     /----+-+++-+++--+--+--++++-+--+---+-+++--+-+---+-----+--\  |    ||   |  | |||/-+-++-++++--+--+------+-\    
| |\----+---+-++-+-+++-+++--++++---+++-----+----+-+++-++/  |  |  |||| |  \---+-+++--+-+---+-----+--+--+----++---+--+-++++-+-++-++++--+--/      | |    
| |     |   | || | ||| |||  ||||   |||     |    | ||| ||   |  |  |||| |      | |||  | |   |     |  |  |    ||   |  | \+++-+-++-+/||  |         | |    
| \-----+---+-++-+-+++-+++--++++---+++-----+----+-+++-++---+--+--++++-+------+-/||  | |   \-----+--+--+----++---+--+--/|| | || | ||  |         | |    
|       |   \-++-+-+++-+++--++++---+++-----+----+-+++-++---+--+--++++-+------+--++--+-+---------+--+--/    ||   |  |   || |/++-+-++--+---------+-+---\
|       |     |\-+-+++-+++--+++/  /+++-----+----+-+++-++---+--+--++++-+------+--++--+-+---------+--+-------++---+--+>--++-++++-+-++--+-------\ | |   |
|       |     |  | ||| |||  |||   ||\+-----+----+-+++-++---+--+--++++-+------+--++--+-+---------+--+-------++---+--+---++-+++/ | ||  |       | | |   |
|       |     |  | ||| |||  |||   || |     |    | ||| ||   \--+--++++-+------+--++--+-+---------+--+-------++---+--+---++-+++--+-++--/       | | |   |
|       |     |  | ||| |||  \++---++-+-----+----+-/|| ||      |  |||| |      |  ||  | |         |  |       ||   |  |   || |||  | ||          | | |   |
|       |     |  | \++-+++---+/   || |     \----+--++-++------+--++++-+------+--++--+-+---------+--/       ||   |  |   || |||  | ||          | | |   |
|       |     |  |  || |||   \----++-+----------+--++-++------+--++++-+---->-+--+/  | |         |          ||   |  |   || |||  | ||          | | |   |
|       |     |  |  || \++--------++-+----------+--++-++------+--++++-/      |  |   | |         \----------++---+--+---++-+++--+-++----------+-/ |   |
|       |     |  |  ||  ||        || |          |  || ||      |  ||||        |  |   | |     /--------------++---+--+---++-+++--+-++-----\    |   |   |
|       |     |  |  ||  ||        || |          |  || ||      |  \+++--------+--+---+-+-----+--------------++---+--+---++-/||  | ||     |    |   |   |
|       |     |  |  ||  ||        || |          |  || ||      |   |||        |  |   \-+-----+--------------/|   |  |   ||  ||  | ||     |    |   |   |
|       |     |  |  ||  ||       /++-+----------+\ || \+------+---+++--------+--+-----+-----+---------------+---+--+---++--++--+-+/     |    |   |   |
|       |     |  |  ||  ||       |\+-+----------++-++--+------+---+++--------+--+-----+-----+---------------+---+--+---++--++--+-+------+----/   |   |
|       |     |  | /++--++-------+-+-+----------++-++--+------+---+++-\      \--+-----+-----+---------------+---+--+---/|  ||  | |      |        |   |
|       |     |  | |||  ||       | | |          || \+--+------+---/|| |         |     |     |               |   |  |    |  ||  | |      |        |   |
|       |     |  | |||  ||       | | |          |v  |  |      |    || |         |     |     |               |   |  |    |  \+--+-+------+--------+---/
|     /-+-----+--+-+++--++-------+-+-+----------++--+--+------+----++-+---------+-----+-----+---------------+\  |  |    |   |  | |      |        |    
|     | |     |  | |||  |\-------+-+-+----------++--+--+------+----++-+---------/     |     |               ||  |  |    |   |  | |      |        |    
|     | |     |  | |||  |        | | \----------++--+--+------+----++-+---------------+-----+---------------++--+--+----+---/  | |      |        |    
|     | |     |  | |||  |        | |            ||  |  \------+----+/ |               |     |               ||  |  |    |      | |      |        |    
|     | |     \--+-+++--/        ^ |            ||  |         |    |  |               |     |               ||  |  |    |      | |      |        |    
|     | |        | ||\-----------+-+------------++--+---------+----+--+---------------/     |               ||  |  |    \------+-+------+--------/    
|     | |        | ||            | |            ||  \---------+----/  |                     |               ||  |  |           | |      |             
\-----+-+--------+-++------------+-+------------++------------+-------+---------------------+---------------/|  |  |           | |      |             
      | |        | |\------------+-+------------++------------+-------+-<-------------------+----------------+--/  \-----------+-/      |             
      | |        | |             \-+------------+/            \-------+---------------------+----------------+-----------------/        |             
      | |        | \---------------+------------+---------------------/                     |                |                          |             
      | |        |                 \------------/                                           \----------------+--------------------------/             
      \-+--------+-------------------------------------------------------------------------------------------/                                        
        \--------/                                                                                                                                    `, true);